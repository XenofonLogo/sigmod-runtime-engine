Αξιολόγηση hash functions για το unchained hashtable

Για την υλοποίηση του unchained hash table πραγματοποιήθηκαν μετρήσεις σε τρεις διαφορετικές συναρτήσεις κατακερματισμού:

CRC32 hashing
Fibonacci (Knuth multiplicative) hashing
std::hash<int32_t>

Κάθε hash function αξιολογήθηκε με βάση:

Ταχύτητα (εκατομμύρια hash operations ανά δευτερόλεπτο)
Κατανομή prefix hashes (χρησιμοποιήθηκαν 12-bit prefixes → 4096 buckets)
Ομοιομορφία και αποφυγή skew στα directory buckets
(κρίσιμο για την απόδοση του unchained hashtable και των probe operations)

Οι δοκιμές έγιναν σε 5.000.000 τυχαία int32 keys.

Αποτελέσματα
1. CRC32 hashing

Throughput: ~471 Mops/s
Max bucket: 5.000.000 (όλα τα στοιχεία σε ένα bucket)

Παρατηρήθηκε πλήρης κατάρρευση των high bits του hash. Όλο το dataset κατέληξε σε έναν μόνο prefix bucket, γεγονός που καθιστά το CRC32 ακατάλληλο για directory-based partitioning.

Απόρριψη λόγω πολύ κακής κατανομής.

2. std::hash<int32_t>

Throughput: ~2242 Mops/s (το γρηγορότερο)
Max bucket: 2.500.627 (πάνω από το 50% των τιμών σε ένα bucket)

Η κατανομή prefix ήταν πάρα πολύ skewed. Το std::hash χρησιμοποιεί πολύ αδύναμη μίξη για int32 και παράγει εξαιρετικά άνιση κατανομή στα MSBs.

Απόρριψη λόγω τεράστιου skew — ακατάλληλο για hash joins.

3. Fibonacci hashing

Throughput: ~1625 Mops/s
Max bucket: 1342 (μόνο ~10% πάνω από το ιδανικό 1220)

Το Fibonacci hashing είχε:

πολύ καλή ομοιομορφία, πολύ κοντινή ομοιόμορφη κατανομή στα 12-bit prefixes,
σταθερή, προβλέψιμη συμπεριφορά χωρίς outliers,
branchless υλοποίηση που εκτελείται εξαιρετικά γρήγορα σε μοντέρνους επεξεργαστές.
Ομοιόμορφη κατανομή + υψηλή απόδοση → ιδανική επιλογή για unchained hashtable.

Συμπέρασμα

Το Fibonacci hashing είναι η μόνη συνάρτηση που:
έχει πολύ καλή ταχύτητα, προσφέρει εξαιρετική κατανομή στα high bits,
ελαχιστοποιεί το skew των directory buckets, βελτιστοποιεί τα probe operations,
ταιριάζει απολύτως με τις απαιτήσεις του unchained hashtable όπως περιγράφεται στο paper.

Τελική επιλογή: Fibonacci Hashing

Οι CRC32 και std::hash απορρίφθηκαν λόγω ακατάλληλης κατανομής των prefix bits, η οποία οδηγεί σε σημαντικό performance degradation.

Το Fibonacci hashing παραμένει η πιο σταθερή, γρήγορη και αξιόπιστη επιλογή για χρήση στο build side του hash join.